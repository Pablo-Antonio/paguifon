{"version":3,"file":"src_app_pages_balance-mifi_balance-mifi_module_ts.js","mappings":"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","sources":["./src/app/pages/balance-mifi/balance-mifi-routing.module.ts","./src/app/pages/balance-mifi/balance-mifi.module.ts","./src/app/pages/balance-mifi/balance-mifi.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { BalanceMifiPage } from './balance-mifi.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: BalanceMifiPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class BalanceMifiPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { BalanceMifiPageRoutingModule } from './balance-mifi-routing.module';\r\n\r\nimport { BalanceMifiPage } from './balance-mifi.page';\r\nimport { SharedModule } from 'src/app/shared/shared.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    BalanceMifiPageRoutingModule,\r\n    SharedModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [BalanceMifiPage]\r\n})\r\nexport class BalanceMifiPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup } from '@angular/forms';\r\nimport { AlertController, LoadingController } from '@ionic/angular';\r\nimport { BalanceService } from '../../core/services/http-request/balance.service';\r\nimport { Validators } from '../../../utils/custom-validators';\r\nimport { StorageService } from '../../core/services/storage.service';\r\n\r\n@Component({\r\n  selector: 'app-balance-mifi',\r\n  templateUrl: './balance-mifi.page.html'\r\n})\r\nexport class BalanceMifiPage implements OnInit {\r\n  title: string = 'Consumo MIFI';\r\n  numberForm: FormGroup;\r\n  selfConsul: string = null;\r\n  data:any = false;\r\n\r\n  constructor(\r\n    private balanceServ: BalanceService,\r\n    private formBuilder: FormBuilder,\r\n    private loadingCtrl: LoadingController,\r\n    private alertCtrl: AlertController,\r\n    private storageServ: StorageService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.formBuil();\r\n    this.storageServ.getMNumber().then(pn => {\r\n      if(!!pn){\r\n        this.selfConsul = pn;\r\n        this.submit({phone_number: pn});\r\n      }\r\n    })\r\n  }\r\n\r\n  formBuil(){\r\n    this.numberForm = this.formBuilder.group({\r\n      phone_number: ['', Validators.phoneNumber]\r\n    });\r\n  }\r\n\r\n  async processRejected(status: string){\r\n    let msj = '';\r\n    switch (status) {\r\n      case 'Active':\r\n        msj = 'No cuentas con un paquete activo, por favor realiza una recarga';\r\n      break;\r\n      case 'Suspend':\r\n        msj = 'La linea ha sido suspendida, favor de comunicarse con su distribuidor';\r\n      break;\r\n      case 'Barring':\r\n        msj = 'Estimado usuario favor de insertar su sim en un equipo compatible con nuestra red';\r\n      break;\r\n      case 'Idle':\r\n        msj = 'No se ha activado ningun plan, favor de comunicarse con su distribuidor';\r\n      break;\r\n      case 'Unanswered':\r\n        msj = 'La linea no ha sido registrada, favor de comunicarse con su distribuidor';\r\n      break;\r\n      default:\r\n        msj = 'Error de comunicación, favor de intentarlo mas tarde';\r\n    }\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: msj,\r\n      buttons: [\r\n        {\r\n          text: 'Cerrar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async submit(auto:any = false){\r\n    if(this.numberForm.valid || auto){\r\n      const value = auto? auto : this.numberForm.value;\r\n      const loading = await this.loadingCtrl.create({message: 'Un momento'});\r\n      await loading.present();\r\n      this.balanceServ.getBalanceMifi(value).then(async res => {\r\n        loading.dismiss();\r\n        if(res.status == 'Active' && res.expire_date != 0){\r\n          this.renderReport(res, value.phone_number);\r\n          this.numberForm.reset();\r\n        }else{\r\n          this.processRejected(res.status)\r\n        }\r\n      }).catch(async err => {\r\n        loading.dismiss();\r\n        const alert = await this.alertCtrl.create({\r\n          header: 'Alerta',\r\n          message: 'Ocurrio un error al conectar con el servidor',\r\n          buttons: [\r\n            {\r\n              text: 'Reintentar',\r\n              handler: () => this.submit()\r\n            },{\r\n              text: 'Ok',\r\n              role: 'cancel'\r\n            }\r\n          ]\r\n        });\r\n        await alert.present();\r\n        console.log(err);\r\n      });\r\n    }\r\n  }\r\n\r\n  formatDate(date: string){\r\n    return `${date.substring(0,4)}-${date.substring(4,6)}-${date.substring(6,8)}`\r\n  }\r\n\r\n  getPercent(total: number, unused: number){\r\n    return total? ((total - unused) / total).toFixed(2) : 1;\r\n  }\r\n\r\n  getDaysLeft(dateEnd: string){\r\n    let ini = new Date().getTime();\r\n    let end = new Date(dateEnd).getTime();\r\n\r\n    var diff = end - ini;\r\n    return Math.ceil(diff/(1000*60*60*24));\r\n  }\r\n\r\n  renderReport(data: any, pn: string){\r\n    data.percentData = this.getPercent(data.data.total, data.data.unused);\r\n    \r\n    data.daysLeft = this.getDaysLeft(this.formatDate(data.expire_date));\r\n    data.phone_number = pn;\r\n    this.data = data;\r\n  }\r\n\r\n  async saveMNumber(pn: string){\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: '¿Quieres guardar este número? si existe alguno este lo reemplazara ',\r\n      buttons: [\r\n        {\r\n          text: 'Confirmar',\r\n          handler: () => {\r\n            this.storageServ.setMNumber(pn);\r\n            this.selfConsul = pn;\r\n          }\r\n        },{\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async deleMNumber(){\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: '¿Quieres eliminar este número?',\r\n      buttons: [\r\n        {\r\n          text: 'Confirmar',\r\n          handler: () => {\r\n            this.storageServ.delMNumber();\r\n            this.selfConsul = null;\r\n          }\r\n        },{\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n}\r\n"],"names":["NgModule","RouterModule","BalanceMifiPage","routes","path","component","BalanceMifiPageRoutingModule","imports","forChild","exports","CommonModule","FormsModule","ReactiveFormsModule","IonicModule","SharedModule","BalanceMifiPageModule","declarations","Component","FormBuilder","AlertController","LoadingController","BalanceService","Validators","StorageService","balanceServ","formBuilder","loadingCtrl","alertCtrl","storageServ","formBuil","getMNumber","then","pn","selfConsul","submit","phone_number","numberForm","group","phoneNumber","status","msj","create","header","message","buttons","text","role","alert","present","auto","valid","value","loading","getBalanceMifi","res","__awaiter","dismiss","expire_date","renderReport","reset","processRejected","catch","err","handler","console","log","date","substring","total","unused","toFixed","dateEnd","ini","Date","getTime","end","diff","Math","ceil","data","percentData","getPercent","daysLeft","getDaysLeft","formatDate","setMNumber","delMNumber","selector","template"],"sourceRoot":"webpack:///"}