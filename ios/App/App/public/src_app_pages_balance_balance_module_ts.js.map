{"version":3,"file":"src_app_pages_balance_balance_module_ts.js","mappings":"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","sources":["./src/app/pages/balance/balance-routing.module.ts","./src/app/pages/balance/balance.module.ts","./src/app/pages/balance/balance.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { BalancePage } from './balance.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: BalancePage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class BalancePageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { BalancePageRoutingModule } from './balance-routing.module';\r\n\r\nimport { BalancePage } from './balance.page';\r\nimport { SharedModule } from 'src/app/shared/shared.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    BalancePageRoutingModule,\r\n    SharedModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [BalancePage]\r\n})\r\nexport class BalancePageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup } from '@angular/forms';\r\nimport { AlertController, LoadingController } from '@ionic/angular';\r\nimport { BalanceService } from '../../core/services/http-request/balance.service';\r\nimport { Validators } from '../../../utils/custom-validators';\r\nimport { StorageService } from '../../core/services/storage.service';\r\n\r\n@Component({\r\n  selector: 'app-balance',\r\n  templateUrl: './balance.page.html'\r\n})\r\nexport class BalancePage implements OnInit {\r\n  title: string = 'Consulta de saldo';\r\n  numberForm: FormGroup;\r\n  selfConsul: string = null;\r\n  data:any = false;\r\n\r\n  constructor(\r\n    private balanceServ: BalanceService,\r\n    private formBuilder: FormBuilder,\r\n    private loadingCtrl: LoadingController,\r\n    private alertCtrl: AlertController,\r\n    private storageServ: StorageService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.formBuil();\r\n    this.storageServ.getPNumber().then(pn => {\r\n      if(!!pn){\r\n        this.selfConsul = pn;\r\n        this.submit({phone_number: pn});\r\n      }\r\n    })\r\n  }\r\n\r\n  formBuil(){\r\n    this.numberForm = this.formBuilder.group({\r\n      phone_number: ['', Validators.phoneNumber]\r\n    });\r\n  }\r\n\r\n  async processRejected(status: string){\r\n    let msj = '';\r\n    switch (status) {\r\n      case 'Active':\r\n        msj = 'No cuentas con un paquete activo, por favor realiza una recarga';\r\n      break;\r\n      case 'Suspend':\r\n        msj = 'La linea ha sido suspendida, favor de comunicarse con su distribuidor';\r\n      break;\r\n      case 'Barring':\r\n        msj = 'Estimado usuario favor de insertar su sim en un equipo compatible con nuestra red';\r\n      break;\r\n      case 'Idle':\r\n        msj = 'No se ha activado ningun plan, favor de comunicarse con su distribuidor';\r\n      break;\r\n      case 'Unanswered':\r\n        msj = 'La linea no ha sido registrada, favor de comunicarse con su distribuidor';\r\n      break;\r\n      default:\r\n        msj = 'Error de comunicación, favor de intentarlo mas tarde';\r\n    }\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: msj,\r\n      buttons: [\r\n        {\r\n          text: 'Cerrar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async submit(auto:any = false){\r\n    if(this.numberForm.valid || auto){\r\n      const value = auto? auto : this.numberForm.value;\r\n      const loading = await this.loadingCtrl.create({message: 'Un momento'});\r\n      await loading.present();\r\n      this.balanceServ.getBalance(value).then(async res => {\r\n        loading.dismiss();\r\n        if(res.status == 'Active' && res.expire_date != 0){\r\n          this.renderReport(res, value.phone_number);\r\n          this.numberForm.reset();\r\n        }else{\r\n          this.processRejected(res.status)\r\n        }\r\n      }).catch(async err => {\r\n        loading.dismiss();\r\n        const alert = await this.alertCtrl.create({\r\n          header: 'Alerta',\r\n          message: 'Ocurrio un error al conectar con el servidor',\r\n          buttons: [\r\n            {\r\n              text: 'Reintentar',\r\n              handler: () => this.submit()\r\n            },{\r\n              text: 'Ok',\r\n              role: 'cancel'\r\n            }\r\n          ]\r\n        });\r\n        await alert.present();\r\n        console.log(err);\r\n      });\r\n    }\r\n  }\r\n\r\n  formatDate(date: string){\r\n    return `${date.substring(0,4)}-${date.substring(4,6)}-${date.substring(6,8)}`\r\n  }\r\n\r\n  getPercent(total: number, unused: number){\r\n    return total? ((total - unused) / total).toFixed(2) : 1;\r\n  }\r\n\r\n  getDaysLeft(dateEnd: string){\r\n    let ini = new Date().getTime();\r\n    let end = new Date(dateEnd).getTime();\r\n\r\n    var diff = end - ini;\r\n    return Math.ceil(diff/(1000*60*60*24));\r\n  }\r\n\r\n  renderReport(data: any, pn: string){\r\n    data.percentData = this.getPercent(data.data.total, data.data.unused);\r\n    data.percentDataThr = this.getPercent(data.data_thr.total, data.data_thr.unused);\r\n    data.percentDataFree = this.getPercent(data.data_free.total, data.data_free.unused);\r\n    data.percentMin = this.getPercent(data.min.total, data.min.unused);\r\n    data.percentSms = this.getPercent(data.sms.total, data.sms.unused);\r\n    \r\n    data.daysLeft = this.getDaysLeft(this.formatDate(data.expire_date));\r\n    data.phone_number = pn;\r\n    this.data = data;\r\n  }\r\n\r\n  async savePNumber(pn: string){\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: '¿Quieres guardar este número? si existe alguno este lo reemplazara ',\r\n      buttons: [\r\n        {\r\n          text: 'Confirmar',\r\n          handler: () => {\r\n            this.storageServ.setPNumber(pn);\r\n            this.selfConsul = pn;\r\n          }\r\n        },{\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async delePNumber(){\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Alerta',\r\n      message: '¿Quieres eliminar este número?',\r\n      buttons: [\r\n        {\r\n          text: 'Confirmar',\r\n          handler: () => {\r\n            this.storageServ.delPNumber();\r\n            this.selfConsul = null;\r\n          }\r\n        },{\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n}\r\n"],"names":["NgModule","RouterModule","BalancePage","routes","path","component","BalancePageRoutingModule","imports","forChild","exports","CommonModule","FormsModule","ReactiveFormsModule","IonicModule","SharedModule","BalancePageModule","declarations","Component","FormBuilder","AlertController","LoadingController","BalanceService","Validators","StorageService","balanceServ","formBuilder","loadingCtrl","alertCtrl","storageServ","formBuil","getPNumber","then","pn","selfConsul","submit","phone_number","numberForm","group","phoneNumber","status","msj","create","header","message","buttons","text","role","alert","present","auto","valid","value","loading","getBalance","res","__awaiter","dismiss","expire_date","renderReport","reset","processRejected","catch","err","handler","console","log","date","substring","total","unused","toFixed","dateEnd","ini","Date","getTime","end","diff","Math","ceil","data","percentData","getPercent","percentDataThr","data_thr","percentDataFree","data_free","percentMin","min","percentSms","sms","daysLeft","getDaysLeft","formatDate","setPNumber","delPNumber","selector","template"],"sourceRoot":"webpack:///"}